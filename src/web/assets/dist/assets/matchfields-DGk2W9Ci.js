Craft.Cockpit.MatchFieldIndex=Craft.BaseElementIndex.extend({editableMatchFieldTypes:null,$newMatchFieldBtnGroup:null,$newMatchFieldBtn:null,init:function(e,t,i){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(e,t,i)},afterInit:function(){this.editableMatchFieldTypes=[];for(const e of Craft.Cockpit.editableMatchFieldTypes)this.getSourceByKey(`matchFieldType:${e.uid}`)&&this.editableMatchFieldTypes.push(e);this.base()},getDefaultSourceKey:function(){if(this.settings.context==="index"&&typeof defaultMatchFieldTypeHandle<"u")for(var e=0;e<this.$sources.length;e++){var t=$(this.$sources[e]);if(t.data("handle")==defaultMatchFieldTypeHandle)return t.data("key")}},updateButton:function(){if(!this.$source)return;const e=this.$source.data("handle");if(this.editableMatchFieldTypes.length){this.$newMatchFieldBtnGroup&&this.$newMatchFieldBtnGroup.remove();const t=this.editableMatchFieldTypes.find(s=>s.handle===e);this.$newMatchFieldBtnGroup=$('<div class="btngroup submit" data-wrapper/>');let i;const d=`new-match-field-menu-${Craft.randomString(10)}`;if(t){const s=this.settings.context==="index"?Craft.t("cockpit","New match field"):Craft.t("cockpit","New {matchFieldType} field",{matchFieldType:t.name}),l=this.settings.context==="index"?Craft.t("cockpit","New {matchFieldType} field",{matchFieldType:t.name}):s,n=this.settings.context==="index"?"link":null;this.$newMatchFieldBtn=Craft.ui.createButton({label:s,ariaLabel:l,spinner:!0,role:n}).addClass("submit add icon").appendTo(this.$newMatchFieldBtnGroup),this.addListener(this.$newMatchFieldBtn,"click mousedown",a=>{this.settings.context==="index"&&(a.type==="click"&&Garnish.isCtrlKeyPressed(a)||a.type==="mousedown"&&a.originalEvent.button===1)?window.open(Craft.getUrl(`cockpit/matchfields/${matchFieldType.handle}/new`)):a.type==="click"&&this._createMatchFieldEntry(t)}),this.editableMatchFieldTypes.length>1&&(i=$("<button/>",{type:"button",class:"btn submit menubtn btngroup-btn-last","aria-controls":d,"data-disclosure-trigger":"","aria-label":Craft.t("cockpit","New match field, choose a type")}).appendTo(this.$newMatchFieldBtnGroup))}else this.$newMatchFieldBtn=i=Craft.ui.createButton({label:Craft.t("cockpit","New match field"),ariaLabel:Craft.t("cockpit","New match field, choose a type"),spinner:!0}).addClass("submit add icon menubtn btngroup-btn-last").attr("aria-controls",d).attr("data-disclosure-trigger","").appendTo(this.$newMatchFieldBtnGroup);if(this.addButton(this.$newMatchFieldBtnGroup),i){const s=$("<div/>",{id:d,class:"menu menu--disclosure"}).appendTo(this.$newMatchFieldBtnGroup),l=$("<ul/>").appendTo(s);for(const n of this.editableMatchFieldTypes){const a=this.settings.context==="index"?"link":"button";if(this.settings.context==="index"||n!==t){const o=$("<li/>").appendTo(l),c=$("<a/>",{role:a==="button"?"button":null,href:Craft.getUrl(`cockpit/matchfields/${n.handle}/new`),type:a==="button"?"button":null,text:Craft.t("cockpit","New {matchFieldType} field",{matchFieldType:n.name})}).appendTo(o);this.addListener(c,"activate",()=>{i.data("trigger").hide(),this._createMatchFieldEntry(n.id)}),a==="button"&&this.addListener(c,"keydown",h=>{h.keyCode===Garnish.SPACE_KEY&&(h.preventDefault(),i.data("trigger").hide(),this._createMatchFieldEntry(n.id))})}}new Garnish.DisclosureMenu(i)}}if(this.settings.context==="index"){let t="cockpit/matchfields";e&&(t+="/"+e),Craft.setPath(t)}},_createMatchFieldEntry:function(e){if(this.$newMatchFieldBtn.hasClass("loading")){console.warn("New match field creation already in progress.");return}const t=this.editableMatchFieldTypes.find(i=>i.id===e);if(!t)throw`Invalid match field type ID: ${e}`;this.$newMatchFieldBtn.addClass("loading"),Craft.sendActionRequest("POST","cockpit/match-fields/create",{data:{siteId:this.siteId,matchFieldType:t.handle}}).then(({data:i})=>{this.settings.context==="index"?document.location.href=Craft.getUrl(i.cpEditUrl,{fresh:1}):Craft.createElementEditor(this.elementType,{siteId:this.siteId,elementId:i.matchfield.id,draftId:i.matchfield.draftId,params:{fresh:1}}).on("submit",()=>{this.clearSearch(),this.setSelectedSortAttribute("dateCreated","desc"),this.selectElementAfterUpdate(i.matchfield.id),this.updateElements()})}).finally(()=>{this.$newMatchFieldBtn.removeClass("loading")})}});
//# sourceMappingURL=matchfields-DGk2W9Ci.js.map
